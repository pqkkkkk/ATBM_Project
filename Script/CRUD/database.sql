CREATE TABLE NHANVIEN (
    MANV VARCHAR2(10) CONSTRAINT PK_NHANVIEN PRIMARY KEY,
    HOTEN NVARCHAR2(50) CONSTRAINT NN_NHANVIEN_HOTEN NOT NULL,
    PHAI NVARCHAR2(10) CHECK (PHAI IN ('Nam', 'Nữ')),
    NGSINH DATE,
    LUONG NUMBER CONSTRAINT CK_NHANVIEN_LUONG CHECK (LUONG >= 0),
    PHUCAP NUMBER CHECK (PHUCAP >= 0),
    DT VARCHAR2(15),
    VAITRO VARCHAR2(10) CHECK (VAITRO IN ('NVCB', 'GV', 'NVPDT','NVPKT', 'NVTCHC','NVCTSV','TRGDV')),
    MADV VARCHAR2(10)
);

CREATE TABLE  DONVI (
    MADV VARCHAR2(10) CONSTRAINT PK_DONVI PRIMARY KEY,
    TENDV NVARCHAR2(100) CONSTRAINT NN_DONVI_TENDV NOT NULL,
    LOAIDV NVARCHAR2(50) CHECK (LOAIDV IN ('Khoa', 'Phòng')),
    TRGDV VARCHAR2(10)
);

CREATE TABLE SINHVIEN (
    MASV VARCHAR2(10) CONSTRAINT PK_SINHVIEN PRIMARY KEY,
    HOTEN NVARCHAR2(50) CONSTRAINT NN_SINHVIEN_HOTEN NOT NULL,
    PHAI NVARCHAR2(10) CHECK (PHAI IN ('Nam', 'Nữ')),
    NGSINH DATE,
    DCHI NVARCHAR2(100),
    DT VARCHAR2(15),
    KHOA VARCHAR2(10),
    TINHTRANG NVARCHAR2(20)
);

CREATE TABLE MOMON (
    MAMM VARCHAR2(10) CONSTRAINT PK_MOMON PRIMARY KEY,
    MAHP VARCHAR2(10),
    MAGV VARCHAR2(10),
    HK NUMBER(1) CHECK (HK IN (1,2,3)),
    NAM NUMBER(4) CHECK (NAM >= 2000)
);

CREATE TABLE HOCPHAN (
    MAHP VARCHAR2(10) CONSTRAINT PK_HOCPHAN PRIMARY KEY,
    TENHP NVARCHAR2(100) CONSTRAINT NN_HOCPHAN_TENHP NOT NULL,
    SOTC NUMBER CHECK (SOTC > 0),
    STLT NUMBER CHECK (STLT >= 0), 
    STTH NUMBER CHECK (STTH >= 0), 
    MADV VARCHAR2(10)
);

CREATE TABLE DANGKY (
    MASV VARCHAR2(10),
    MAMM VARCHAR2(10),
    DIEMTH NUMBER(4,2) CHECK (DIEMTH BETWEEN 0 AND 10),
    DIEMCT NUMBER(4,2) CHECK (DIEMCT BETWEEN 0 AND 10), 
    DIEMCK NUMBER(4,2) CHECK (DIEMCK BETWEEN 0 AND 10), 
    DIEMTK NUMBER(4,2) CHECK (DIEMTK BETWEEN 0 AND 10), 
    CONSTRAINT PK_DANGKY PRIMARY KEY (MASV, MAMM)
);
CREATE TABLE THONGBAO (
    MATB NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NGAYTB DATE DEFAULT SYSDATE,
    NOIDUNG NVARCHAR2(1000)
);

ALTER TABLE NHANVIEN ADD CONSTRAINT FK_NHANVIEN_DONVI FOREIGN KEY (MADV) REFERENCES DONVI(MADV)
ON DELETE SET NULL;
ALTER TABLE HOCPHAN ADD CONSTRAINT FK_HOCPHAN_DONVI FOREIGN KEY (MADV) REFERENCES DONVI(MADV)
ON DELETE SET NULL;
ALTER TABLE MOMON ADD CONSTRAINT FK_MOMON_HOCPHAN FOREIGN KEY (MAHP) REFERENCES HOCPHAN(MAHP)
ON DELETE CASCADE;
ALTER TABLE MOMON ADD CONSTRAINT FK_MOMON_NHANVIEN FOREIGN KEY (MAGV) REFERENCES NHANVIEN(MANV)
ON DELETE SET NULL;
ALTER TABLE DANGKY ADD CONSTRAINT FK_DANGKY_SINHVIEN FOREIGN KEY (MASV) REFERENCES SINHVIEN(MASV)
ON DELETE CASCADE;
ALTER TABLE DANGKY ADD CONSTRAINT FK_DANGKY_MOMON FOREIGN KEY (MAMM) REFERENCES MOMON(MAMM)
ON DELETE CASCADE;
ALTER TABLE DONVI ADD CONSTRAINT FK_TRUONGDONVI FOREIGN KEY (TRGDV) REFERENCES NHANVIEN(MANV)
ON DELETE SET NULL;
ALTER TABLE SINHVIEN ADD CONSTRAINT FK_KHOA FOREIGN KEY (KHOA) REFERENCES DONVI(MADV) 
ON DELETE SET NULL;
ALTER TABLE SINHVIEN ADD CONSTRAINT CK_SINHVIEN_TINHTRANG CHECK (TINHTRANG IN ('Đang học', 'Tốt nghiệp', 'Nghỉ học', 'Bảo lưu'));

-- Create role NVCB
CREATE ROLE XR_NVCB;
-- Create role GV
CREATE ROLE XR_GV;
-- Create role NVPDT
CREATE ROLE XR_NVPDT;
-- Create role NVPKT
CREATE ROLE XR_NVPKT;
-- Create role NVTCHC
CREATE ROLE XR_NVTCHC;
-- Create role NVCTSV
CREATE ROLE XR_NVCTSV;
-- Create role TRGDV
CREATE ROLE XR_TRGDV;
-- Create role SINHVIEN
CREATE ROLE XR_SV;
COMMIT;

