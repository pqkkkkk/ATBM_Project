CREATE TABLE X_ADMIN.NHANVIEN (
    MANV VARCHAR2(10) CONSTRAINT PK_NHANVIEN PRIMARY KEY,
    HOTEN NVARCHAR2(50) CONSTRAINT NN_NHANVIEN_HOTEN NOT NULL,
    PHAI NVARCHAR2(10) CHECK (PHAI IN ('Nam', 'Nữ')),
    NGSINH DATE,
    LUONG NUMBER CONSTRAINT CK_NHANVIEN_LUONG CHECK (LUONG >= 0),
    PHUCAP NUMBER CHECK (PHUCAP >= 0),
    DT VARCHAR2(15),
    VAITRO VARCHAR2(10) CHECK (VAITRO IN ('NVCB', 'GV', 'NVPDT','NVPKT', 'NVTCHC','NVCTSV','TRGDV')),
    MADV VARCHAR2(10),
    COSO VARCHAR2(10) CHECK (COSO IN ('CS1', 'CS2'))
);

CREATE TABLE  X_ADMIN.DONVI (
    MADV VARCHAR2(10) CONSTRAINT PK_DONVI PRIMARY KEY,
    TENDV NVARCHAR2(100) CONSTRAINT NN_DONVI_TENDV NOT NULL,
    LOAIDV NVARCHAR2(50) CHECK (LOAIDV IN ('Khoa', 'Phòng')),
    TRGDV VARCHAR2(10)
);

CREATE TABLE X_ADMIN.SINHVIEN (
    MASV VARCHAR2(10) CONSTRAINT PK_SINHVIEN PRIMARY KEY,
    HOTEN NVARCHAR2(50) CONSTRAINT NN_SINHVIEN_HOTEN NOT NULL,
    PHAI NVARCHAR2(10) CHECK (PHAI IN ('Nam', 'Nữ')),
    NGSINH DATE,
    DCHI NVARCHAR2(100),
    DT VARCHAR2(15),
    KHOA VARCHAR2(10),
    TINHTRANG NVARCHAR2(20),
    COSO VARCHAR2(10) CHECK (COSO IN ('CS1', 'CS2'))
);

CREATE TABLE X_ADMIN.MOMON (
    MAMM VARCHAR2(10) CONSTRAINT PK_MOMON PRIMARY KEY,
    MAHP VARCHAR2(10),
    MAGV VARCHAR2(10),
    HK NUMBER(1) CHECK (HK IN (1,2,3)),
    NAM NUMBER(4) CHECK (NAM >= 2000)
);

CREATE TABLE X_ADMIN.HOCPHAN (
    MAHP VARCHAR2(10) CONSTRAINT PK_HOCPHAN PRIMARY KEY,
    TENHP NVARCHAR2(100) CONSTRAINT NN_HOCPHAN_TENHP NOT NULL,
    SOTC NUMBER CHECK (SOTC > 0),
    STLT NUMBER CHECK (STLT >= 0), 
    STTH NUMBER CHECK (STTH >= 0), 
    MADV VARCHAR2(10)
);

CREATE TABLE X_ADMIN.DANGKY (
    MASV VARCHAR2(10),
    MAMM VARCHAR2(10),
    DIEMTH NUMBER(4,2) CHECK (DIEMTH BETWEEN 0 AND 10),
    DIEMCT NUMBER(4,2) CHECK (DIEMCT BETWEEN 0 AND 10), 
    DIEMCK NUMBER(4,2) CHECK (DIEMCK BETWEEN 0 AND 10), 
    DIEMTK NUMBER(4,2) CHECK (DIEMTK BETWEEN 0 AND 10), 
    CONSTRAINT PK_DANGKY PRIMARY KEY (MASV, MAMM)
);
CREATE TABLE X_ADMIN.THONGBAO (
    MATB NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    NGAYTB DATE DEFAULT SYSDATE,
    NOIDUNG NVARCHAR2(1000),
    LABEL NUMBER(20)
);

ALTER TABLE X_ADMIN.NHANVIEN ADD CONSTRAINT FK_NHANVIEN_DONVI FOREIGN KEY (MADV) REFERENCES X_ADMIN.DONVI(MADV)
ON DELETE SET NULL;
ALTER TABLE X_ADMIN.HOCPHAN ADD CONSTRAINT FK_HOCPHAN_DONVI FOREIGN KEY (MADV) REFERENCES X_ADMIN.DONVI(MADV)
ON DELETE SET NULL;
ALTER TABLE X_ADMIN.MOMON ADD CONSTRAINT FK_MOMON_HOCPHAN FOREIGN KEY (MAHP) REFERENCES X_ADMIN.HOCPHAN(MAHP)
ON DELETE CASCADE;
ALTER TABLE X_ADMIN.MOMON ADD CONSTRAINT FK_MOMON_NHANVIEN FOREIGN KEY (MAGV) REFERENCES X_ADMIN.NHANVIEN(MANV)
ON DELETE SET NULL;
ALTER TABLE X_ADMIN.DANGKY ADD CONSTRAINT FK_DANGKY_SINHVIEN FOREIGN KEY (MASV) REFERENCES X_ADMIN.SINHVIEN(MASV)
ON DELETE CASCADE;
ALTER TABLE X_ADMIN.DANGKY ADD CONSTRAINT FK_DANGKY_MOMON FOREIGN KEY (MAMM) REFERENCES X_ADMIN.MOMON(MAMM)
ON DELETE CASCADE;
ALTER TABLE X_ADMIN.DONVI ADD CONSTRAINT FK_TRUONGDONVI FOREIGN KEY (TRGDV) REFERENCES X_ADMIN.NHANVIEN(MANV)
ON DELETE SET NULL;
ALTER TABLE X_ADMIN.SINHVIEN ADD CONSTRAINT FK_KHOA FOREIGN KEY (KHOA) REFERENCES X_ADMIN.DONVI(MADV) 
ON DELETE SET NULL;
ALTER TABLE X_ADMIN.SINHVIEN ADD CONSTRAINT CK_SINHVIEN_TINHTRANG CHECK (TINHTRANG IN ('Đang học', 'Tốt nghiệp', 'Nghỉ học', 'Bảo lưu'));

COMMIT;

